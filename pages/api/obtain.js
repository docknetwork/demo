const actualCredentialAttachment = {
  schema_id: 'W2u9PzjDmhKM5xLABjAqav:2:Staff Passport:0.1',
  cred_def_id: 'W2u9PzjDmhKM5xLABjAqav:3:CL:59553:latest',
  key_correctness_proof: {
    c: '91041441283682096073202709856212735294233462364326520059384621178754442188222',
    xz_cap:
      '2092625098346226719001519583786385308599816324540990898859732031532407658841142711829882665552559642780539725106234049831900342021105277321109261113396728142046168369174506621318918022090483688332345017403405182744284627754917417947175847852032135822701524233239106194615243498741275573404065758647598778055335099335319608747343803512268500007459990121965636838285629541558998988948669326378249029504854991985957030842238624434130080162546381189407225869264273943056699311840968434813547810196047331157914627016797734826620896376633250268111785533488780873083446622251897559922299562268080776733704395766313844703068607468603781952668540413843054093229702484555112064387654664997192668132632648',
    xr_cap: [
      [
        'employer',
        '1840495016798418077154601431073215152877720917743879678929938305276058051951825701485736781522100594281323206526803013221478385301681748832584717388719590454906519295784065039412189941160792328731485721948968077216411566687684270785314133692204408066906878087956785507173985926009627420293590021611289080531668851366035582038683030954605646408763973087712266409723606369431884522271568223018543022355213475949432420763316859737306772907057448822234852599162609852499333476281321893188440863406660553675081442419608079708876602525598919002651535208258960632677418656651926289355590646140817756782046323251126743799123791703068683369610541570624167801532995742502503799393745580243414579480560504',
      ],
      [
        'role',
        '92489241651514552436196133194354913031433016514397692066579497341329706436010627584779078349636570770751104974901671214008924526168271111447214795052894047536131061132083938535672528412724140957462799947414555203001673314010204402101777763160321646806734098927912153842997797017479226015210435497373628463648078693793300608875404163597309338311616570130700667323782439326123319838077436427575218155021241736647324806310629580364621412094608130552406240251890720955726074266196477271433288335278489379799355527534032167509163275155952779917454227054641384361195115680139673612454269142307224008038129557292089721274924146295982056709685302139638496299508826199881274382243473633790093144608621',
      ],
      [
        'systemaccess',
        '1306417145488424523946980405734788925005020111866772441702888618128187797877575121439220283148835783250836618431774530085009718943269316156936611506691950669349694955154381637463950977821862420574351181503808934815125471756349878141272411278322154557029317256897789235709926176468952904620342923089607915340100870950031334251022867677487756499543924648605846539260465278742219283299740454189573071747928448174504575691725368660179385061763264819814011462419562260328980526374285013383869065085288782525751947319962271650863265888037844305192972079770507827629358339301585752897554572905505267034623118435090537795807997345443515750296968565254485340686786880731665874670650731542087621749505428',
      ],
      [
        'master_secret',
        '1622112505641527776428844708743057474681160769852512275028430823980207275036634817423284734600006337126093165425882336138845216189407955943403965724621942223081536891165217660692911062053855415211992654123300562722623495002905232104308499954535902138085942443211283006676167336229163763147347046922748446998895743298441196683130249292642016278528401703332956984265136390964213141784406829690475282213998665843411684582068419685082421213632733344099355120856470660018266169187947295099054355487239589577946422332619587019924683344252829762421422223808318665413915349851256606183914991681692735678909864707252382230477614444677087533022230137791965584070131514583940840917236607017702277946111024',
      ],
      [
        'firstname',
        '1695002761112569339348138546055583798066804186644905301935130974557833723695272706094885371153476618785450221877516608172702287806524685683722147634931909078881134403464514310142232421629699268292649883517320560688715731933340519573490067562474250967379919416795960552090578127504143925852478994238220256426346671594620051561122553916094819135328735903764123023274883398652363513663458373123992536563831859988079125515966989440980126377768198013787532121325354751925042206249327759497828932031786335347076371237127508872237179414702680419454080958921230347985016668636943604583843842441638982875192281953893120772093213850449007465308817508088277512554024605754744087411321510162466243109592322',
      ],
      [
        'lastname',
        '262982904585581492270878093175914409577121115483234222008081602274666760945906678334274540281098080318132122454187619554923211384448709595806614377150850433739338171283561424250453169263760225189720613679867727566050217121068370429134975019280897691686464442519231044782541560769453120998729904043940471507990145856860747670200563734132836066107023381629914251047452722655684803785093823800520121859872869225190466764559141890126112373513176589771059151559235386137508467526973506847416841702621634151939027765065689601852296625271028069895141077832716996133818464543708521322082909759140732330504777814665741866509008740963633473578726953538154202711975695284813331915228068458566427657725289',
      ],
      [
        'location',
        '1167200823694461817533903519781231932453025911956282825862533253279691489115308673203046318141031688542122164788286166618126092605302489694250725589653418699820739451706714931398108236787875296248434026607541676818997547916951215639177900250267183153447378647174942735751234413907835255576986277257524150322226340958275378757016599119711849413600541296611964456299743202680455336825445343061435559699615603177515044407122154138594916798920364178780521379893402269512409903506767190951633683828117805009320510379886749637027957343216661304361234245890992046561560952090935559587209655837876788624004964882395584179689470089428227650009966810411015608446718186051625068292577103642904278564117788',
      ],
    ],
  },
  nonce: '82707824528210051516703',
};

const actualCredentialAttachmentB64 = Buffer.from(
  JSON.stringify(actualCredentialAttachment)
).toString('base64');

const credOffer = {
  credential_preview: {
    '@type': 'did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/credential-preview',
    attributes: [
      {
        name: 'Location',
        value: 'WestHaven Hospital',
      },
      {
        name: 'Role',
        value: 'Nurse Practicioner',
      },
      {
        name: 'Employer',
        value: 'SunCrest Medical Inc',
      },
      {
        name: 'System Access',
        value: 'Full',
      },
      {
        name: 'First Name',
        value: 'Alice',
      },
      {
        name: 'Last Name',
        value: 'Jones',
      },
    ],
  },
  'offers~attach': [
    {
      '@id': 'libindy-cred-offer-0',
      'mime-type': 'application/json',
      data: {
        base64: actualCredentialAttachmentB64,
      },
    },
  ],
  comment: 'Staff Passport',
  '@type': 'did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/issue-credential/1.0/offer-credential',
  '@id': '96ba8546-34c0-44d1-a2bd-8ef7988b09ed',
  '~thread': {
    thid: '1edc4e46-936f-4712-befd-26557c29b4d6',
  },
};

function createOutOfBandInvitation(issuerName, issuerDID, issuerLogo, requests) {
  return {
    label: issuerName,
    goal_code: 'issue-vc',
    goal: 'To issue a credential',
    'request~attach': requests,
    service: [
      {
        id: 'Rvk6PCqf4ysaeAod9sJZ2P;indy',
        type: 'IndyAgent', // TODO: change from indyagent to dockagent?
        recipientKeys: [
          'Eayna6BEzGGJeAeXnZ5hpr3J3QLLHJdNqsXey1SGB32c', // tODO: where dose key come from? anoncrypt? our pub key?
        ],
        serviceEndpoint: 'https://vas.evernym.com/agency/msg', // TODO: point to dock api?
        // "serviceEndpoint": "https://ca01-45-86-200-187.ngrok.io/api/msg" // TODO: point to dock api?
      },
    ],
    profileUrl: issuerLogo,
    public_did: issuerDID,
    '@id':
      '9Rp6Jk3-HwcjgSeug-QNeF6Wijb-AqmUTYYxW-mtwVvLChwMwKk8hYcJmQPkdaEznMkgVS6wN2RSyeRe1gRGvnvgNbZ1qpN7HwYPKrALMtVQCPg6Gh6mmMz',
    '@type': 'did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/out-of-band/1.0/invitation',
    handshake_protocols: ['did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/connections/1.0'],
  };
}

function createRequestAttachment(jsonObj) {
  return {
    '@id': '1b9a5b5e-8dd9-4a0b-bbac-aff2a5922727', // tODO: random uuid?
    'mime-type': 'application/json',
    data: {
      base64: Buffer.from(JSON.stringify(jsonObj)).toString('base64'),
    },
  };
}

export default async (req, res) => {
  const issuerName = 'Acme Inc';
  const issuerDID = 'did:sov:W2u9PzjDmhKM5xLABjAqav';
  const issuerLogo = 'https://i.postimg.cc/bvs8K9bJ/Sun-Crest-Medical-logo.png';
  const requests = [createRequestAttachment(credOffer)];

  const invite = createOutOfBandInvitation(issuerName, issuerDID, issuerLogo, requests);

  res.json(invite);
};
